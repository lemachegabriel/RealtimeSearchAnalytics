<h1 class="text-3xl font-bold underline text-red-600">Real-time Search</h1>
<input type="text" id="search_box" placeholder="Search...">
<div id="results"></div>

<script>
  function debounce(func, wait) {
    let timeout;
    return function(...args) {
      clearTimeout(timeout);
      timeout = setTimeout(() => func.apply(this, args), wait);
    };
  }

  document.addEventListener("DOMContentLoaded", function() {
    const csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');
    const searchBox = document.getElementById('search_box');

    let userId = localStorage.getItem('user_id');
    if (!userId) {
      userId = 'user_' + Math.random().toString(36).substr(2, 10);
      localStorage.setItem('user_id', userId);
    }

    searchBox.addEventListener('input', debounce(function() {
      const term = this.value;

      fetch('/searches', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRF-Token': csrfToken
        },
        body: JSON.stringify({ term: term, user_id: userId })
      });
    }, 300));
  });
</script>
